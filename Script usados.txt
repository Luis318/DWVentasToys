Script usados 

-- Llenar DimTiempo

DECLARE @StartDate date = '20100101';
DECLARE @EndDate   date = '20401231';

SET LANGUAGE Spanish;  -- para DATENAME en español
SET DATEFIRST 1;       -- 1 = lunes (sáb=6, dom=7)

;WITH Dates AS (
    SELECT d = @StartDate
    UNION ALL
    SELECT DATEADD(DAY, 1, d)
    FROM Dates
    WHERE d < @EndDate
)
INSERT INTO dw.DimTiempo (
    TiempoKey, Fecha, Anio, Trimestre, Mes, NombreMes, Dia, NombreDia, EsFinDeSemana
)
SELECT
    TiempoKey      = DATEDIFF(DAY, @StartDate, d) + 1,          -- 2010-01-01 => 1
    Fecha          = d,
    Anio           = YEAR(d),
    Trimestre      = (MONTH(d) + 2) / 3,                        -- 1..4
    Mes            = MONTH(d),
    NombreMes      = UPPER(LEFT(DATENAME(MONTH, d), 1)) + SUBSTRING(DATENAME(MONTH, d), 2, 14),
    Dia            = DAY(d),
    NombreDia      = UPPER(LEFT(DATENAME(WEEKDAY, d), 1)) + SUBSTRING(DATENAME(WEEKDAY, d), 2, 14),
    EsFinDeSemana  = CASE WHEN DATEPART(WEEKDAY, d) IN (6, 7) THEN 1 ELSE 0 END
FROM Dates
WHERE NOT EXISTS (
    SELECT 1 FROM dw.DimTiempo t WHERE t.Fecha = d
)
OPTION (MAXRECURSION 0);


select * from Sales

SELECT
    s.OrderNumber,
    s.Quantity,
    s.UnitPrice,
    s.DiscountAmount,
    s.CustomerStateID,
    isNULL(so.SalesOfficeID, 0) as SalesOfficeID,   
    st.StateID,
    isNULL(s.PromotionCode, 'sin Promocion') as PromotionCode,
    p.ProductID,
    isNULL(s.ShipDate, '') as ShipDate,
    isNULL(s.OrderDate,'') as OrderDate
FROM dbo.Sales AS s
INNER JOIN dbo.State  AS st ON st.StateID  = s.CustomerStateID
INNER JOIN dbo.Product AS p ON p.ProductID = s.ProductID
OUTER APPLY (
    SELECT TOP (1) soi.SalesOfficeID
    FROM dbo.SalesOffice AS soi
    WHERE soi.StateID = st.StateID
    ORDER BY soi.SalesOfficeID
) AS so
ORDER BY s.OrderNumber;







